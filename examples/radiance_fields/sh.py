
import torch
def spherical_harmonics(points):
    p = points.reshape(-1, 3)
    x, y, z = p.chunk(3, -1)
    o = torch.ones_like(x)
    z = torch.zeros_like(x)
    xx, yy, zz = x * x, y * y, z * z
    xy, yz, zx = x * y, y * z, z * x
    return torch.cat([
        0.28209479177387814 * o,
        -0.48860251190291987*y,
        0.48860251190291987*z,
        -0.48860251190291987*x,
        1.0925484305920792*xy,
        -1.0925484305920792*yz,
        0.94617469575755997*zz - 0.31539156525251999,
        -1.0925484305920792*zx,
        0.54627421529603959*xx - 0.54627421529603959*yy,
        0.59004358992664352*y*(-3.0*xx + yy),
        2.8906114426405538*xy*z,
        0.45704579946446572*y*(1.0 - 5.0*zz),
        0.3731763325901154*z*(5.0*zz - 3.0),
        0.45704579946446572*x*(1.0 - 5.0*zz),
        1.4453057213202769*z*(xx - yy),
        0.59004358992664352*x*(-xx + 3.0*yy),
    ], -1).view(points.shape[:-1] + (16,))